# LINE通信ルール

Claude Code (Worker3) とLINE間の通信における必須ルール

---

## 📋 基本原則

### 1. 即座受付・後日完了報告

**すべてのタスクは以下の2段階で処理**:

1. **即座に受付確認** (3秒以内)
   - 「✅ 受付完了」をLINEに返信
   - タスク内容を確認したことを通知

2. **完了時に結果報告** (必須)
   - タスク完了時
   - 作業が滞った時
   - 判断に迷った時
   - エラーが発生した時

---

## 🔔 報告義務（重要）

### 必ず報告すべきタイミング

#### ✅ タスク完了時
```
✅ タスク完了

【実施内容】
- コード実装完了
- テスト実施完了

【結果】
正常に動作しました。
```

#### ⏸️ 作業が滞った時
```
⏸️ 作業中断

【現状】
○○の実装中に△△の問題が発生

【原因】
依存ライブラリのバージョン不整合

【対応方針】
ライブラリを更新して再試行します
```

#### ❓ 判断に迷った時
```
❓ 確認依頼

【状況】
2つの実装アプローチがあります

【選択肢】
A: シンプルだが拡張性低い
B: 複雑だが将来的に有利

どちらを採用しますか？
```

#### ❌ エラー発生時
```
❌ エラー発生

【エラー内容】
ModuleNotFoundError: numpy

【原因】
必要なライブラリ未インストール

【対応】
pip install numpy を実行中
```

---

## ⏱️ タイムアウト管理

### 短期タスク (1-60秒)
- 簡単な質問
- コード確認
- ファイル検索

→ **即座に回答可能**

### 中期タスク (1-10分)
- コード実装
- テスト実行
- 調査・分析

→ **完了後に報告**

### 長期タスク (10分以上)
- 大規模リファクタリング
- 複数ファイルの修正
- 複雑なデバッグ

→ **進捗報告を随時送信**（5分ごと推奨）

---

## 📨 メッセージフォーマット

### 受付確認
```
✅ 受付完了

【依頼内容】
{ユーザーの依頼内容}

処理を開始します。
完了次第、結果をお送りします。
```

### 完了報告
```
✅ 完了報告

【実施内容】
- {実施した作業1}
- {実施した作業2}

【結果】
{結果の詳細}

【成果物】
{ファイル名やコミットID等}
```

### 進捗報告
```
📊 進捗報告

【現在の状況】
全10ファイル中、5ファイル完了

【完了項目】
✅ ファイルA修正
✅ ファイルB修正

【残り項目】
⬜ ファイルC修正
⬜ ファイルD修正

あと5分程度で完了予定です。
```

---

## 🚫 禁止事項

### ❌ 無言でタスク実行
- タスク受付後、完了まで何も連絡しない
- エラーが発生しても報告しない
- 迷っているのに相談しない

### ❌ 曖昧な返信
```
❌ 悪い例:
「処理中です」（いつ終わるか不明）

✅ 良い例:
「処理中です。あと3分程度で完了予定」
```

### ❌ タイムアウト後の無視
- 10分経過後も報告なし
- エラーが出ているのに放置

---

## 📊 報告頻度の目安

| タスクタイプ | 報告頻度 | 例 |
|------------|---------|-----|
| 即時タスク | 即座に完了報告 | コード確認 |
| 短期タスク | 完了時のみ | 単一ファイル修正 |
| 中期タスク | 完了時 + エラー時 | コード実装 |
| 長期タスク | 5分ごと + 完了時 | 大規模リファクタリング |

---

## 🎯 実践例

### 例1: コード実装依頼

**ユーザー**: 「ログイン機能を実装して」

**Claude Code**:
```
[即座]
✅ 受付完了

【依頼内容】
ログイン機能を実装

処理を開始します。

[5分後 - 完了]
✅ 完了報告

【実施内容】
- login.py 作成
- 認証ロジック実装
- テスト実行（全てパス）

【成果物】
/auth/login.py

ログイン機能が正常に動作します。
```

### 例2: 調査依頼

**ユーザー**: 「エラーの原因を調べて」

**Claude Code**:
```
[即座]
✅ 受付完了

【依頼内容】
エラーの原因調査

処理を開始します。

[3分後 - 完了]
✅ 調査結果

【原因】
ライブラリのバージョン不整合

【詳細】
numpy 1.x が必要だが 2.x がインストール済み

【対応方法】
pip install numpy==1.24.0
```

### 例3: 判断が必要なケース

**ユーザー**: 「パフォーマンスを改善して」

**Claude Code**:
```
[即座]
✅ 受付完了

【依頼内容】
パフォーマンス改善

処理を開始します。

[2分後 - 確認依頼]
❓ 実装方針の確認

【状況】
2つの改善案があります

【案A: キャッシュ導入】
- 効果: 50%高速化
- リスク: メモリ使用量増加

【案B: アルゴリズム最適化】
- 効果: 30%高速化
- リスク: コード複雑化

どちらを採用しますか？
```

---

## 🔧 システム仕様

### タイムアウト設定
- **受付確認**: 3秒以内
- **短期タスク**: 60秒以内
- **中期タスク**: 10分以内
- **長期タスク**: 進捗報告を随時

### 技術実装
- threading による非同期処理
- LINE reply_message (受付確認)
- LINE push_message (結果報告)

---

**最終更新**: 2025-10-12
**管理責任者**: Claude Code Team
**適用範囲**: 全LINEメッセージ処理
