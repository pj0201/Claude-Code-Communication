# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ACE Learning Engine ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®3å±¤æ§‹é€ ](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®3å±¤æ§‹é€ )
3. [ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯](#ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯)
4. [ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–](#ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–)
5. [ã‚¨ãƒ©ãƒ¼é€šçŸ¥](#ã‚¨ãƒ©ãƒ¼é€šçŸ¥)
6. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## æ¦‚è¦

ACE Learning Engine ã¯ã€å¤–éƒ¨ APIï¼ˆGitHubç­‰ï¼‰ã¨ã®é€šä¿¡æ™‚ã«ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã«å¯¾ã—ã¦è‡ªå‹•çš„ã«ãƒªãƒˆãƒ©ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚

**ä¸»ãªç‰¹å¾´**:

- âœ… **æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•**: ãƒªãƒˆãƒ©ã‚¤ã®é–“éš”ã‚’æŒ‡æ•°é–¢æ•°çš„ã«å¢—åŠ 
- âœ… **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å®‰å…¨æ€§**: å†ªç­‰æ€§ã®ã‚ã‚‹æ“ä½œã®ã¿ãƒªãƒˆãƒ©ã‚¤
- âœ… **æ§‹é€ åŒ–ãƒ­ã‚°**: ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’ JSON å½¢å¼ã§è¨˜éŒ²
- âœ… **é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **: Emailãƒ»Slackãƒ»ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥ã«å¯¾å¿œ
- âœ… **ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–**: ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®ä¾‹å¤–ã§è©³ç´°æƒ…å ±ã‚’ä¿æŒ

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®3å±¤æ§‹é€ 

```
å±¤3: ã‚¨ãƒ©ãƒ¼é€šçŸ¥
     â†“
     Email / Slack / ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥

å±¤2: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²
     â†“
     æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONå½¢å¼ï¼‰

å±¤1: ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
     â†“
     æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ä»˜ãè‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
```

### å±¤1: ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯

**å½¹å‰²**: ãƒˆãƒ©ãƒ³ã‚¸ã‚§ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ï¼ˆä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ï¼‰ã‚’è‡ªå‹•çš„ã«è§£æ±º

**å¯¾è±¡ã‚¨ãƒ©ãƒ¼**:
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- HTTP 5xx ã‚¨ãƒ©ãƒ¼ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ï¼‰
- ä¸€æ™‚çš„ãªæ¥ç¶šéšœå®³

**éå¯¾è±¡ã‚¨ãƒ©ãƒ¼**:
- èªè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆ400, 401, 403ï¼‰
- ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ï¼ˆ400, 422ï¼‰
- ãƒªã‚½ãƒ¼ã‚¹ä¸åœ¨ï¼ˆ404ï¼‰

### å±¤2: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²

**å½¹å‰²**: ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è©³ç´°ã«è¨˜éŒ²

**è¨˜éŒ²é …ç›®**:
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
- ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±
- ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆDEBUG ãƒ¢ãƒ¼ãƒ‰ï¼‰

### å±¤3: ã‚¨ãƒ©ãƒ¼é€šçŸ¥

**å½¹å‰²**: é‡è¦ãªã‚¨ãƒ©ãƒ¼ã‚’ç®¡ç†è€…ã«é€šçŸ¥

**é€šçŸ¥æ–¹æ³•**:
- Emailï¼ˆè¨­å®šæ™‚ï¼‰
- Slackï¼ˆè¨­å®šæ™‚ï¼‰
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¸¸æ™‚ï¼‰

---

## ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```python
from a2a_system.skills.error_handler import retry_with_exponential_backoff

@retry_with_exponential_backoff(
    max_retries=3,
    base_delay=2,
    max_delay=30,
    exceptions=(urllib.error.HTTPError, urllib.error.URLError),
)
def call_github_api(url, payload):
    # GitHub API ã‚’å‘¼ã³å‡ºã—
    response = urllib.request.urlopen(request)
    return response
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|---------|-----|
| `max_retries` | 3 | æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•° |
| `base_delay` | 1 | åˆæœŸé…å»¶ï¼ˆç§’ï¼‰ |
| `max_delay` | 60 | æœ€å¤§é…å»¶ï¼ˆç§’ï¼‰ |
| `exceptions` | (Exception,) | ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ã®ä¾‹å¤–ã‚¿ãƒ—ãƒ« |
| `on_retry` | None | ãƒªãƒˆãƒ©ã‚¤æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

### æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã®è¨ˆç®—

```
ãƒªãƒˆãƒ©ã‚¤å›æ•°: 1      â†’ é…å»¶: 1ç§’ (base_delay Ã— 2^0)
ãƒªãƒˆãƒ©ã‚¤å›æ•°: 2      â†’ é…å»¶: 2ç§’ (base_delay Ã— 2^1)
ãƒªãƒˆãƒ©ã‚¤å›æ•°: 3      â†’ é…å»¶: 4ç§’ (base_delay Ã— 2^2)
ãƒªãƒˆãƒ©ã‚¤å›æ•°: 4      â†’ é…å»¶: 8ç§’ (base_delay Ã— 2^3)
            :
max_delay ã«é”ã—ãŸã‚‰ ãã“ã§é ­æ‰“ã¡
```

**ä¾‹**: base_delay=2, max_delay=30 ã®å ´åˆ

```
è©¦è¡Œ1: å³åº§ã«å®Ÿè¡Œ (é…å»¶ãªã—)
è©¦è¡Œ2: 2ç§’å¾…æ©Ÿ (2^0 Ã— 2 = 2ç§’)
è©¦è¡Œ3: 4ç§’å¾…æ©Ÿ (2^1 Ã— 2 = 4ç§’)
è©¦è¡Œ4: 8ç§’å¾…æ©Ÿ (2^2 Ã— 2 = 8ç§’)
è©¦è¡Œ5: 16ç§’å¾…æ©Ÿ (2^3 Ã— 2 = 16ç§’)
è©¦è¡Œ6: 30ç§’å¾…æ©Ÿ (2^4 Ã— 2 = 32ç§’ â†’ max_delay ã«åˆ¶é™)
```

### ãƒªãƒˆãƒ©ã‚¤æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯

```python
def on_retry_callback(attempt, max_attempts, exception):
    """
    ãƒªãƒˆãƒ©ã‚¤æ™‚ã«å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯

    Args:
        attempt: ç¾åœ¨ã®è©¦è¡Œç•ªå·
        max_attempts: æœ€å¤§è©¦è¡Œå›æ•°
        exception: ç™ºç”Ÿã—ãŸä¾‹å¤–
    """
    logger.info(f"ãƒªãƒˆãƒ©ã‚¤ {attempt}/{max_attempts}: {exception}")

@retry_with_exponential_backoff(
    max_retries=3,
    on_retry=on_retry_callback,
    exceptions=(urllib.error.HTTPError,),
)
def call_api():
    pass
```

---

## ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–

### ACEExceptionï¼ˆåŸºæœ¬ä¾‹å¤–ï¼‰

```python
from a2a_system.skills.error_handler import ACEException

exc = ACEException(
    message="Something went wrong",
    error_code="CUSTOM_ERROR",
    details={"key": "value"}
)

# è©³ç´°æƒ…å ±ã‚’è¾æ›¸ã¨ã—ã¦å–å¾—
error_dict = exc.to_dict()
# {
#     "message": "Something went wrong",
#     "error_code": "CUSTOM_ERROR",
#     "details": {"key": "value"},
#     "timestamp": "2025-10-22T10:00:00"
# }
```

### GitHubAPIErrorï¼ˆGitHub API ã‚¨ãƒ©ãƒ¼ï¼‰

```python
from a2a_system.skills.error_handler import GitHubAPIError

try:
    # GitHub API å‘¼ã³å‡ºã—
    response = urllib.request.urlopen(request)
except urllib.error.HTTPError as e:
    raise GitHubAPIError(
        message="Failed to create ISSUE",
        status_code=e.code,
        response_body=e.read().decode('utf-8')
    )
```

**è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆæ©Ÿèƒ½**:
GitHubAPIError ã¯ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¿œã˜ã¦ã€è‡ªå‹•çš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆã‚’ç”Ÿæˆã—ã¾ã™ï¼š

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆ |
|------|---|
| 401 | GitHub ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã¾ãŸã¯æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã§ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚ |
| 403 | ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¨©é™ä¸è¶³ã§ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ |
| 404 | æŒ‡å®šã•ã‚ŒãŸãƒªãƒã‚¸ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚GITHUB_REPO ã®å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ |
| 422 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã§ã™ã€‚ISSUE ã‚¿ã‚¤ãƒˆãƒ«ãƒ»æœ¬æ–‡ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚ |
| 429 | API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…æ©Ÿã—ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚ |
| 5xx | GitHub ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚æ•°åˆ†å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚ |

ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®å–å¾—ä¾‹ï¼š
```python
try:
    create_github_issue(title, body)
except GitHubAPIError as e:
    error_dict = e.to_dict()
    print(f"Error: {error_dict['message']}")
    print(f"Action: {error_dict['actionable_advice']}")  # â† ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
```

### WikiUploadErrorï¼ˆWIKI ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼‰

```python
from a2a_system.skills.error_handler import WikiUploadError

try:
    # WIKI ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    with open(filepath, 'w') as f:
        f.write(content)
except IOError as e:
    raise WikiUploadError(
        message="Failed to write WIKI file",
        path=filepath
    )
```

### BackupErrorï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼ï¼‰

```python
from a2a_system.skills.error_handler import BackupError

try:
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
    shutil.copy(source, backup_path)
except OSError as e:
    raise BackupError(
        message="Backup creation failed",
        backup_path=backup_path
    )
```

---

## ã‚¨ãƒ©ãƒ¼é€šçŸ¥

### safe_operation ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿

```python
from a2a_system.skills.error_handler import safe_operation

@safe_operation(
    operation_name="GitHub ISSUE ä½œæˆ",
    default_return=False,
    should_raise=False,
)
def create_issue(title, body):
    # å®Ÿè£…
    pass

# å¤±æ•—æ™‚ã¯ False ã‚’è¿”ã—ã€ãƒ­ã‚°ã«ã¯ ERROR ãƒ¬ãƒ™ãƒ«ã§è¨˜éŒ²
result = create_issue(title, body)
```

### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²

```python
from a2a_system.skills.error_handler import log_error, get_notifier

try:
    # ä½•ã‹å‡¦ç†
    pass
except Exception as e:
    # ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’æ§‹é€ åŒ–ãƒ­ã‚°ã¨ã—ã¦è¨˜éŒ²
    error_info = log_error(
        e,
        context={"operation": "test", "user_id": 123},
        level="ERROR"
    )

    # é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã«é€ä¿¡
    notifier = get_notifier()
    notifier.notify(error_info, severity="ERROR")
```

### Email é€šçŸ¥ã®è¨­å®š

```python
from a2a_system.skills.error_handler import EmailNotifier, get_notifier

# Email é€šçŸ¥ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½œæˆ
email_notifier = EmailNotifier(
    smtp_server="mail.example.com",
    smtp_port=587,
    from_addr="noreply@example.com",
    to_addrs=["admin@example.com", "ops@example.com"],
)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²
notifier = get_notifier()
notifier.register_handler(email_notifier.send)

# ä»¥å¾Œã®ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã« Email ã§é€šçŸ¥ã•ã‚Œã¾ã™
```

### Slack é€šçŸ¥ã®è¨­å®š

```python
from a2a_system.skills.error_handler import SlackNotifier, get_notifier

# Slack é€šçŸ¥ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½œæˆ
slack_notifier = SlackNotifier(
    webhook_url="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²
notifier = get_notifier()
notifier.register_handler(slack_notifier.send)

# ä»¥å¾Œã®ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã« Slack ã§é€šçŸ¥ã•ã‚Œã¾ã™
```

### é‡å¤§åº¦åˆ¥é€šçŸ¥ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆç–²ã‚Œå¯¾ç­–ï¼‰

é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã¯é‡å¤§åº¦ã«å¿œã˜ã¦ã€é€ä¿¡å…ˆã‚’è‡ªå‹•çš„ã«é¸åˆ¥ã—ã¾ã™ï¼š

| é‡å¤§åº¦ | é€šçŸ¥å…ˆ | èª¬æ˜ |
|--------|--------|------|
| WARNING | ãƒ­ã‚°ã®ã¿ | è­¦å‘Šã ãŒå‡¦ç†ã¯ç¶šè¡Œã€‚Email/Slack é€šçŸ¥ã¯é€ã‚‰ãªã„ |
| ERROR | Email | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã€‚ç®¡ç†è€…ã¸ã® Email é€šçŸ¥ã®ã¿ |
| CRITICAL | Email + Slack | è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã€‚Email ã¨ Slack ã®ä¸¡æ–¹ã«ç·Šæ€¥é€šçŸ¥ |

**ä½¿ç”¨ä¾‹**:
```python
notifier = get_notifier()

# å‡¦ç†ã®é…å»¶ï¼šãƒ­ã‚°ã®ã¿
notifier.notify(error_info, severity="WARNING")

# GitHub API ã‚¨ãƒ©ãƒ¼ï¼šEmail é€šçŸ¥
notifier.notify(error_info, severity="ERROR")

# ã‚·ã‚¹ãƒ†ãƒ ãƒ€ã‚¦ãƒ³ï¼šEmail + Slack é€šçŸ¥
notifier.notify(error_info, severity="CRITICAL")
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€**ã‚¢ãƒ©ãƒ¼ãƒˆç–²ã‚Œã‚’é˜²ããªãŒã‚‰é‡å¤§ãªå•é¡Œã«ã¯ç´ æ—©ãå¯¾å¿œ**ã§ãã¾ã™ã€‚

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ã‹ã©ã†ã‹ã‚’åˆ¤æ–­

**ãƒªãƒˆãƒ©ã‚¤ã™ã¹ãï¼ˆãƒˆãƒ©ãƒ³ã‚¸ã‚§ãƒ³ãƒˆï¼‰ã‚¨ãƒ©ãƒ¼**:
```python
@retry_with_exponential_backoff(
    exceptions=(
        urllib.error.URLError,  # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
        urllib.error.HTTPError,  # HTTP ã‚¨ãƒ©ãƒ¼ï¼ˆ5xxãªã©ï¼‰
        TimeoutError,             # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        ConnectionError,          # æ¥ç¶šã‚¨ãƒ©ãƒ¼
    )
)
def call_external_api():
    pass
```

**ãƒªãƒˆãƒ©ã‚¤ã—ã¦ã¯ã„ã‘ãªã„ã‚¨ãƒ©ãƒ¼**:
```python
# èªè¨¼ã‚¨ãƒ©ãƒ¼ã€ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãªã©ã¯
# ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ã‹ã‚‰é™¤å¤–
@retry_with_exponential_backoff(
    exceptions=(urllib.error.URLError,),  # URLError ã®ã¿
)
def call_api():
    pass
```

### 2. é©åˆ‡ãªãƒªãƒˆãƒ©ã‚¤å›æ•°ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®š

```python
# GitHub API: ä¸­ç¨‹åº¦ã®ãƒªãƒˆãƒ©ã‚¤ï¼ˆ3å›ï¼‰
@retry_with_exponential_backoff(
    max_retries=3,
    base_delay=2,
    max_delay=30,
)
def create_github_issue():
    pass

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: ç©æ¥µçš„ãªãƒªãƒˆãƒ©ã‚¤ï¼ˆ5å›ï¼‰
@retry_with_exponential_backoff(
    max_retries=5,
    base_delay=1,
    max_delay=60,
)
def backup_learning_data():
    pass
```

### 3. ãƒªãƒˆãƒ©ã‚¤ä¸å¯ã®æ“ä½œã¯ safe_operation ã§ä¿è­·

```python
from a2a_system.skills.error_handler import safe_operation

@safe_operation("æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ", default_return=False)
def generate_monthly_report():
    # ãƒªãƒˆãƒ©ã‚¤ã§ã¯ãªãã€ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚°ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã™
    pass
```

### 4. ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨˜éŒ²

```python
from a2a_system.skills.error_handler import log_error

try:
    create_github_issue(title, body)
except Exception as e:
    error_info = log_error(
        e,
        context={
            "operation": "GitHub ISSUE ä½œæˆ",
            "title": title,
            "repo": os.getenv("GITHUB_REPO"),
            "attempt": current_attempt,
        },
        level="ERROR"
    )
```

### 5. ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚’ä½¿ç”¨

```python
from a2a_system.skills.error_handler import GitHubAPIError

try:
    response = urllib.request.urlopen(request)
except urllib.error.HTTPError as e:
    # æ±ç”¨ã® Exception ã§ã¯ãªãã€GitHubAPIError ã‚’ä½¿ç”¨
    raise GitHubAPIError(
        message=f"Failed to create ISSUE: {e.reason}",
        status_code=e.code,
        response_body=e.read().decode('utf-8')
    )
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: ãƒªãƒˆãƒ©ã‚¤ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

**åŸå› å€™è£œ**:
1. ä¾‹å¤–ãŒ `exceptions` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã¦ã„ãªã„
2. ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡å¤–ã®ä¾‹å¤–ãŒç™ºç”Ÿã—ã¦ã„ã‚‹

**ç¢ºèªæ–¹æ³•**:
```python
# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’ DEBUG ã«è¨­å®š
import logging
logging.basicConfig(level=logging.DEBUG)

# ãƒªãƒˆãƒ©ã‚¤ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã®çŠ¶æ…‹ã‚’ãƒ­ã‚°ã§ç¢ºèª
# "ğŸ”„ å®Ÿè¡Œè©¦è¡Œ" ã¨ã„ã†ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
```

**è§£æ±º**:
```python
import urllib.error

@retry_with_exponential_backoff(
    exceptions=(urllib.error.HTTPError, urllib.error.URLError),
)
def call_api():
    pass
```

### Q: ä½•åº¦ã‚‚ãƒªãƒˆãƒ©ã‚¤ã•ã‚Œã‚‹ï¼ˆå®Ÿè¡ŒãŒé…ã„ï¼‰

**åŸå› **: ãƒªãƒˆãƒ©ã‚¤å›æ•°ãŒå¤šã™ãã‚‹ã€ã¾ãŸã¯åˆæœŸé…å»¶ãŒå¤§ãã„

**è§£æ±º**:
```python
@retry_with_exponential_backoff(
    max_retries=2,        # 3å›ã‹ã‚‰2å›ã«å‰Šæ¸›
    base_delay=1,         # 2ç§’ã‹ã‚‰1ç§’ã«å‰Šæ¸›
    max_delay=10,         # æœ€å¤§é…å»¶ã‚’åˆ¶é™
)
def call_api():
    pass
```

### Q: Email é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œãªã„

**åŸå› å€™è£œ**:
1. SMTP è¨­å®šãŒæ­£ã—ããªã„
2. Email ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç„¡åŠ¹
3. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãŒ SMTP ãƒãƒ¼ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯

**ç¢ºèªæ–¹æ³•**:
```python
import smtplib

# SMTP æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
try:
    with smtplib.SMTP("mail.example.com", 587) as server:
        server.starttls()
        print("âœ… SMTP æ¥ç¶šæˆåŠŸ")
except Exception as e:
    print(f"âŒ SMTP æ¥ç¶šå¤±æ•—: {e}")
```

### Q: Slack é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› å€™è£œ**:
1. Webhook URL ãŒç„¡åŠ¹
2. é€šçŸ¥ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„

**ç¢ºèªæ–¹æ³•**:
```python
from a2a_system.skills.error_handler import get_notifier

# ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
notifier = get_notifier()
print(f"ç™»éŒ²ã•ã‚ŒãŸãƒãƒ³ãƒ‰ãƒ©ãƒ¼: {len(notifier.handlers)}")

# æ‰‹å‹•ã§é€šçŸ¥ã‚’ãƒ†ã‚¹ãƒˆ
error_info = {"error_type": "Test", "error_message": "Test error"}
notifier.notify(error_info, severity="ERROR")
```

---

## ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘

| ãƒ¬ãƒ™ãƒ« | ç”¨é€” | ä¾‹ |
|--------|------|-----|
| DEBUG | è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æƒ…å ± | ãƒªãƒˆãƒ©ã‚¤è©¦è¡Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è©³ç´° |
| INFO | é€šå¸¸ã®ãƒ­ã‚° | å‡¦ç†é–‹å§‹ã€å‡¦ç†å®Œäº† |
| WARNING | è­¦å‘Šï¼ˆã‚·ã‚¹ãƒ†ãƒ ã¯å‹•ä½œï¼‰ | API ã‚¨ãƒ©ãƒ¼ã‹ã‚‰ã®å¾©æ—§ã€ã‚¹ã‚­ãƒƒãƒ—ã—ãŸå‡¦ç† |
| ERROR | ã‚¨ãƒ©ãƒ¼ï¼ˆå‡¦ç†å¤±æ•—ï¼‰ | æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å¾Œã®å¤±æ•—ã€å¿…é ˆãƒªã‚½ãƒ¼ã‚¹ä¸åœ¨ |
| CRITICAL | è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ | ã‚·ã‚¹ãƒ†ãƒ åœæ­¢ãƒ¬ãƒ™ãƒ«ã®éšœå®³ |

**è¨­å®šæ–¹æ³•**:
```bash
# ç’°å¢ƒå¤‰æ•°ã§è¨­å®š
export LOG_LEVEL=DEBUG
python3 a2a_system/scripts/monthly_summary.py

# ã¾ãŸã¯ .env ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®š
echo "LOG_LEVEL=DEBUG" >> .env
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### ãƒªãƒˆãƒ©ã‚¤ã®ç·å®Ÿè¡Œæ™‚é–“

```
base_delay=2, max_retries=3 ã®å ´åˆ:
è©¦è¡Œ1: 0ç§’
è©¦è¡Œ2: +2ç§’ = 2ç§’
è©¦è¡Œ3: +4ç§’ = 6ç§’
è©¦è¡Œ4: +8ç§’ = 14ç§’

æœ€å¤§å®Ÿè¡Œæ™‚é–“: ç´„14ç§’ï¼ˆAPIå‡¦ç†æ™‚é–“ã‚’é™¤ãï¼‰
```

### æ¨å¥¨è¨­å®š

**ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªå‡¦ç†**:
```python
# ä½•ã¨ã—ã¦ã‚‚æˆåŠŸã•ã›ãŸã„å ´åˆ
max_retries=5, base_delay=1, max_delay=60
```

**é€šå¸¸ã®å‡¦ç†**:
```python
# ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸè¨­å®šï¼ˆæ¨å¥¨ï¼‰
max_retries=3, base_delay=2, max_delay=30
```

**é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹å¿…é ˆ**:
```python
# ç´ æ—©ãå¤±æ•—ã—ãŸã„å ´åˆ
max_retries=1, base_delay=0.5, max_delay=5
```

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Exponential Backoff - AWS Documentation](https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/)
- [Retry Pattern - Microsoft](https://docs.microsoft.com/en-us/azure/architecture/patterns/retry)
- [Python logging - Official Documentation](https://docs.python.org/3/library/logging.html)

---

**æœ€çµ‚æ›´æ–°**: 2025-10-22
