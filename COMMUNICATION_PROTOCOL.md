# Worker2 ↔ Worker3 双方向通信プロトコル

**確立日**: 2025-10-18
**ステータス**: ✅ 本番運用確認済み

---

## 📡 通信チャネル仕様

### ペイン情報

| Worker | セッション | ウィンドウ | ペイン | 完全指定 |
|--------|-----------|---------|--------|---------|
| **Worker2** | worker2-bridge | 0 | 0 | `worker2-bridge:0.0` |
| **Worker3** | gpt5-a2a-line | 0 | 1 | `gpt5-a2a-line:0.1` |

---

## 🔄 通信方法

### Worker2 → Worker3 へメッセージ送信

**スクリプト使用**:
```bash
./send-to-worker3.sh "メッセージ内容"
```

**直接コマンド**:
```bash
tmux send-keys -t gpt5-a2a-line:0.1 -l "メッセージ"
tmux send-keys -t gpt5-a2a-line:0.1 C-m
```

### Worker3 → Worker2 へメッセージ送信

**スクリプト使用**:
```bash
./send-to-worker2.sh "メッセージ内容"
```

**直接コマンド**:
```bash
tmux send-keys -t worker2-bridge:0.0 -l "メッセージ"
tmux send-keys -t worker2-bridge:0.0 C-m
```

---

## ✅ テスト結果

**実施日**: 2025-10-18
**テスト形式**: 小メッセージ複数回送受信

**結果**: ✅ **完全成功**
- ✅ Worker2→Worker3: すべてのメッセージ受信確認
- ✅ Worker3→Worker2: すべてのメッセージ受信確認
- ✅ エンターキー: 確実に実行
- ✅ 双方向通信: 完全稼働

**Worker3 最終確認**:
> 「2つのコマンド分離方法を理解しました。エンターキーボトルネック完全解決。」

---

## 🔑 重要な実装ルール

**エンターキー送信の必須ルール**:
1. **メッセージと C-m は必ず 2 つのコマンドに分離**
   - ❌ 間違い: `tmux send-keys -t [ペイン] "メッセージ" C-m`
   - ✅ 正しい:
     ```bash
     tmux send-keys -t [ペイン] -l "メッセージ"
     tmux send-keys -t [ペイン] C-m
     ```

2. **`-l` フラグ（リテラルモード）を必ず使用**
   - メッセージの特殊文字を正しく解釈
   - エンターキー送信の確実性を保証

---

**このプロトコルは本番運用環境で確認済みです。**
